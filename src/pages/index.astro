---
import BaseLayout from "../layouts/BaseLayout.astro";
import MonthCard from "../components/MonthCard.astro";
import { getCollection } from "astro:content";
import { getUrl } from "../utils/url";

// Get all workout programs
const allWorkouts = await getCollection("workouts");

// Filter out any entries without monthSlug and sort by monthSlug in descending order (newest first)
const months = allWorkouts
  .filter(entry => entry.data.monthSlug) // Only include entries with monthSlug
  .sort((a, b) => (b.data.monthSlug || "").localeCompare(a.data.monthSlug || ""));

const featured = months[0]; // First item is the most recent

const siteBase = Astro.site
  ? new URL(import.meta.env.BASE_URL || "/", Astro.site).href.replace(/\/$/, "")
  : "";

const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: "FORGED",
  url: `${siteBase}/`,
  description: "Free structured monthly workout programs built on progressive overload and periodization. Designed for intermediate lifters who want real programming — not random exercises.",
  publisher: {
    "@type": "Organization",
    name: "FORGED",
    url: `${siteBase}/`,
    logo: {
      "@type": "ImageObject",
      url: `${siteBase}/favicon.svg`,
    },
  },
};

const faqs = [
  {
    question: "What kind of workouts are in FORGED programs?",
    answer:
      "Each monthly program includes four workout types: Push, Pull, Full Body, and Engine (conditioning). Push sessions focus on pressing and overhead movements; Pull sessions target rows, hinges, and pulling patterns; Full Body days combine compound lifts across all planes; and Engine sessions develop cardiovascular capacity and work capacity through functional conditioning work. Together they cover all major movement patterns and energy systems.",
  },
  {
    question: "How long does each workout take?",
    answer:
      "Sessions are designed to take 45–60 minutes. Managing your rest periods between sets is the primary lever for staying within that window. Warm-up and cool-down are not included in that estimate, so budget a few extra minutes on each end.",
  },
  {
    question: "What equipment do I need?",
    answer:
      "FORGED programs are written for a home gym with basic equipment — barbell, dumbbells, pull-up bar, kettlebell, and a bench — or any standard commercial gym. No specialty machines are required. Most movements have dumbbell or bodyweight substitutions if a piece of equipment isn't available.",
  },
  {
    question: "How do rest days work?",
    answer:
      "Rest days are intentionally not programmed. You decide when to take them based on how your body feels, your schedule, and your recovery. A common approach is 3–4 training days per week with at least one rest day between harder sessions. Prioritize sleep, nutrition, and recovery the same way you prioritize training.",
  },
  {
    question: "How often are new programs released?",
    answer:
      "A new 4-week program is generated and published every month. Each program is built on progressive overload and periodization principles so that training stress increases appropriately week over week. Previous months remain available so you can revisit or repeat any program.",
  },
];

const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  mainEntity: faqs.map((faq) => ({
    "@type": "Question",
    name: faq.question,
    acceptedAnswer: {
      "@type": "Answer",
      text: faq.answer,
    },
  })),
};
---

<BaseLayout
  title="Home"
  description="Free structured monthly workout programs built on progressive overload and periodization. Designed for intermediate lifters who want real programming — not random exercises."
  schema={[websiteSchema, faqSchema]}
>

  <!-- ─── Hero Section ─── -->
  <section class="relative overflow-hidden">
    {/* Background texture */}
    <div class="absolute inset-0 bg-gradient-to-br from-primary/5 via-base-100 to-accent/5"></div>
    <div class="absolute inset-0 opacity-[0.03]" style="background-image: radial-gradient(circle at 1px 1px, currentColor 1px, transparent 0); background-size: 24px 24px;"></div>

    <div class="relative max-w-5xl mx-auto px-4 lg:px-8 py-16 sm:py-24">
      <div class="grid lg:grid-cols-2 gap-12 items-center">

        {/* Left: Text Content */}
        <div>
          {/* Headline */}
          <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight leading-[1.1]" style="font-family: 'Outfit', sans-serif;">
            Free Workout
            <br />
            Programs,
            <br />
            <span class="text-primary">Ready to Go.</span>
          </h1>

          {/* Description */}
          <p class="text-lg text-base-content/60 mt-5 max-w-lg leading-relaxed">
            <strong>Stop Guessing. Start Training.</strong> — Monthly programs built on progressive
            overload and periodization. Just pick a program and go.
          </p>

          {/* CTAs */}
          <div class="flex flex-wrap gap-3 mt-8">
            {featured && (
              <a
                href={getUrl(`workouts/${featured.data.monthSlug}`)}
                class="btn btn-primary btn-md gap-2"
              >
                Start Current Program
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
              </a>
            )}
            <a href="#programs" class="btn btn-ghost btn-md">
              Browse All Programs
            </a>
          </div>

          {/* Stats strip */}
          <div class="grid grid-cols-3 gap-4 mt-12 pt-8 border-t border-base-300">
            <div>
              <p class="text-2xl font-bold text-primary" style="font-family: 'Outfit', sans-serif;">
                {months.length}
              </p>
              <p class="text-xs text-base-content/40 mt-0.5">Programs</p>
            </div>
            <div>
              <p class="text-2xl font-bold" style="font-family: 'Outfit', sans-serif;">
                {months.length * 4} {/* Approximate 4 weeks per month */}
              </p>
              <p class="text-xs text-base-content/40 mt-0.5">Workouts</p>
            </div>
            <div>
              <p class="text-2xl font-bold" style="font-family: 'Outfit', sans-serif;">
                100%
              </p>
              <p class="text-xs text-base-content/40 mt-0.5">Free</p>
            </div>
          </div>
        </div>

        {/* Right: Hero Image */}
        <div class="relative lg:order-last max-w-xs sm:max-w-sm lg:max-w-none mx-auto w-full">
          <div class="relative rounded-2xl overflow-hidden shadow-2xl border border-base-300">
            <img
              src={`${import.meta.env.BASE_URL}/hero_image.jpg`}
              alt="Athlete training in gym"
              class="w-full h-auto object-cover aspect-[4/3]"
              loading="eager"
            />
            {/* Optional overlay gradient for depth */}
            <div class="absolute inset-0 bg-gradient-to-t from-base-300/20 to-transparent pointer-events-none"></div>
          </div>

          {/* Decorative element */}
          <div class="absolute -bottom-6 -right-6 w-32 h-32 bg-primary/10 rounded-full blur-3xl -z-10"></div>
          <div class="absolute -top-6 -left-6 w-40 h-40 bg-accent/10 rounded-full blur-3xl -z-10"></div>
        </div>

      </div>
    </div>
  </section>

  <!-- ─── Programs Listing ─── -->
  <section id="programs" class="max-w-5xl mx-auto px-4 lg:px-8 py-12 sm:py-16">
    <div class="flex items-end justify-between mb-8">
      <div>
        <h2 class="text-2xl sm:text-3xl font-bold tracking-tight" style="font-family: 'Outfit', sans-serif;">
          All Programs
        </h2>
        <p class="text-sm text-base-content/50 mt-1">Ordered by date, newest first</p>
      </div>
    </div>

    {/* Grid of month cards */}
    <div class="grid gap-4 sm:grid-cols-2">
      {months.map((month, index) => {
        // Parse the month slug to get a display name (e.g., "2026-02" -> "February 2026")
        const date = month.data.monthSlug ? new Date(`${month.data.monthSlug}-01`) : new Date();
        const monthName = date.toLocaleString('default', { month: 'long' });
        const year = date.getFullYear();
        const displayDate = `${monthName} ${year}`;
        
        return (
          <MonthCard
            title={month.data.title || displayDate}
            monthSlug={month.data.monthSlug}
            phase={month.data.title || displayDate}
            goal={month.data.title ? `Workout program for ${displayDate}` : `Monthly workout program for ${displayDate}`}
            split="Full Body"
            totalDays={4} // Default to 4 weeks
            startDate={month.data.monthSlug || displayDate}
            featured={index === 0}
          />
        );
      })}
    </div>

    {months.length === 0 && (
      <div class="text-center py-16">
        <p class="text-base-content/40 text-lg">No programs yet. Check back soon!</p>
      </div>
    )}
  </section>

  <!-- ─── FAQ Section ─── -->
  <section class="max-w-3xl mx-auto px-4 lg:px-8 py-12 sm:py-16">
    <div class="mb-8">
      <h2 class="text-2xl sm:text-3xl font-bold tracking-tight" style="font-family: 'Outfit', sans-serif;">
        Frequently Asked Questions
      </h2>
      <p class="text-sm text-base-content/50 mt-1">Everything you need to know before you start.</p>
    </div>

    <div class="flex flex-col divide-y divide-base-300">
      {faqs.map((faq) => (
        <details class="group py-4">
          <summary class="flex items-center justify-between gap-4 cursor-pointer list-none">
            <span class="font-semibold text-base leading-snug" style="font-family: 'Outfit', sans-serif;">
              {faq.question}
            </span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-4 h-4 shrink-0 text-base-content/40 transition-transform duration-200 group-open:rotate-180"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </summary>
          <p class="mt-3 text-base-content/60 text-sm leading-relaxed">
            {faq.answer}
          </p>
        </details>
      ))}
    </div>

    <p class="mt-8 text-xs text-base-content/30 leading-relaxed">
      Always consult a qualified physician or healthcare provider before beginning any new exercise program. FORGED programs are for informational purposes only and are not a substitute for professional medical advice.
    </p>
  </section>

</BaseLayout>
